<!DOCTYPE html>
<html>

<head>
    <title>Leaflet Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #map {
            height: 1000px;
        }

        html,
        body {
            padding: 0;
            margin: 0;
            height: 100%;
        }

        #lmap {
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="lmap"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- <script>
        var map = L.map('map').setView([23.8895, 121.1917], 8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
            maxZoom: 12,
        }).addTo(map);

        // 使用 Ajax 方法加载 GeoJSON 数据
        fetch('Taiwan.json')
            .then(response => response.json())
            .then(geojsonData => {
                // 创建 Leaflet 地图实例并显示 GeoJSON 数据
                L.geoJSON(geojsonData).addTo(map);
            })
            .catch(error => {
                console.error('Error loading GeoJSON data:', error);
            });
    </script> -->

    <!-- heatmap -->
    <script src="node_modules/heatmap.js/build/heatmap.min.js"></script>
    <script src="node_modules/heatmap.js/plugins/leaflet-heatmap/leaflet-heatmap.js"></script>
    <script>
        const LMap = L.map(document.getElementById('lmap'), {
            center: [23.5, 121],
            zoom: 7,
            crs: L.CRS.EPSG3857,
        });
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            maxZoom: 18,
            id: 'mapbox.streets'
        }).addTo(LMap);
        let arr = [];
        function CreatePoint(count) {
            for (let i = 0; i < count; i++) {
                let longitude = random(120.5, 121.4);
                let latitude = random(23, 24.6);
                let value = Math.floor(random(0, 100));

                arr.push({ x: longitude, y: latitude, value: value });
            }
        }
        function random(min, max) {
            return Math.random() * (max - min) + min;
        }
        CreatePoint(100);

        const option = {
            "scaleRadius": false,
            "radius": 50,
            "useLocalExtrema": true,
            latField: 'y',
            lngField: 'x',
            valueField: 'value',
            "maxOpacity": .5
        };
        const heatmapLayer = new HeatmapOverlay(option);
        const testData = {
            max: 100,
            data: arr
        };
        heatmapLayer.setData(testData);
        heatmapLayer.addTo(LMap);
    </script>
    <!-- D3 -->
    <!-- <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script>
        // 使用 d3.json() 方法加载地图数据和气温数据
        Promise.all([
            d3.json('Taiwan.json'), // 替换为你的地图数据路径
            d3.json('weather.json')   // 替换为你的气温数据路径
        ]).then(([mapData, temperatureData]) => {
            // 在这里编写 D3.js 代码，处理地图数据和气温数据
            const svg = d3.select('body').append('svg');

            // 设定投影函数和路径生成器
            const projection = d3.geoMercator().fitSize([10000, 10000], mapData);
            const path = d3.geoPath().projection(projection);

            // 绘制地图
            svg
                .selectAll('path')
                .data(mapData.features)
                .enter()
                .append('path')
                .attr('d', path)
                .attr('fill', 'lightgray')
                .attr('stroke', 'white');

            // 提取气温信息
            const temperatureDataMap = {};
            temperatureData.records.location.forEach(location => {
                const temperatureElement = location.weatherElement.find(element => element.elementName === "TEMP");
                if (temperatureElement) {
                    temperatureDataMap[location.locationName] = temperatureElement.elementValue;
                }
            });
            // 绘制气温信息
            svg
                .selectAll('text')
                .data(mapData.features)
                .enter()
                .append('text')
                .attr('x', d => path.centroid(d)[0])
                .attr('y', d => path.centroid(d)[1])
                .text(d => temperatureDataMap[d.properties.NAME_2010]) // 根据地名获取气温数据
                .attr('text-anchor', 'middle')
                .attr('fill', 'black');
        });
    </script> -->
</body>

</html>